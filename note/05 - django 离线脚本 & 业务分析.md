# 05 - django离线脚本 & 业务分析

## 概要

- 项目页面
- django写离线脚本
- 业务分析

- 设计表结构
- 功能实现
  - 查看项目列表
  - 创建项目
  - 星标项目



## 详细

### 1. django离线脚本

- 在某个py文件中对django项目做一些处理

```
django, 框架
离线， 非web运行时
脚本， 一个或几个jpy文件
```

#### 示例1： 使用离线脚本在用户表插入数据

```python
import os
import sys
import django

base_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
sys.path.append(base_dir)
# 写入环境变量
os.environ.setdefault("DJANGO_SETTINGS_MODULE", 'MyDjango.settings')
# 模拟manage.py 启动
django.setup()  # os.environ['DJANGO_SETTINGS_MODULE']

from web import models
# 往数据库添加数据： 连接数据库、操作、关闭连接
models.UserInfo.objects.create(username='若尘', email='ruochen@live.com', mobile_phone='16666666666', password='123123123')

```

#### 示例2： 数据库录入全国省市县

#### 示例3： 朋友圈项目敏感字、词语

#### 示例4： saas免费版：1G、5项目、10人



### 2. 业务分析

#### 2.1 价格策略

| ID   | 分类   | 标题       | 价格/年 | 创建项目个数 | 每个项目成员 | 每个项目空间 | 单文件 | 创建时间 |
| ---- | :----- | ---------- | ------- | ------------ | ------------ | ------------ | ------ | -------- |
| 1    | 免费版 | 个人免费版 | 0       | 3            | 2            | 20M          | 5M     |          |
| 2    | 收费版 | VIP        | 199     | 20           | 100          | 50G          | 500M   |          |
| 3    | 收费版 | SVIP       | 299     | 50           | 200          | 100G         | 1G     |          |
| 4    | 其他   |            |         |              |              |              |        |          |

注意：新用户注册拥有免费版的额度。

#### 2.2 用户

| ID   | 用户名  | 手机号       | 密码 |
| ---- | ------- | ------------ | ---- |
| 1    | alex    | 166666666666 | 111  |
| 2    | natasha | 18888888888  | 222  |
| 3    | misha   | 12222222222  | 333  |

#### 2.3 交易

| ID   | 状态          | 用户 | 价格 | 实际支付 | 开始      | 结束      | 数量（年） | 订单 |
| ---- | ------------- | ---- | ---- | -------- | --------- | --------- | ---------- | ---- |
| 1    | 已支付        | 1    | 1    | 0        | 2020-7-5  | null      | 0          | TT01 |
| 2    | 已支付        | 1    | 1    | 0        | 2020-7-5  | null      | 0          | TT02 |
| 3    | 已支付        | 1    | 1    | 0        | 2020-7-5  | null      | 0          | TT03 |
| 4    | 已支付        | 2    | 2    | 199      | 2020-8-5  | 2021-8-5  | 1          | TT04 |
| 5    | 未支付/已支付 | 3    | 3    | 299*2    | 2020-10-5 | 2021-10-5 | 2          | TT05 |

`request.tracer = 交易对象`

#### 2.4 创建存储

- 基于腾讯对象存储COS存储数据

#### 2.5 项目

| ID   | 项目名称 | 描述 | 颜色    | 星标  | 参与人数 | 创建者 | 已使用空间 |
| ---- | -------- | ---- | ------- | ----- | -------- | ------ | ---------- |
| 1    | crm      | xxx  | `#dddd` | true  | 20       | 2      | 10M        |
| 2    | django   | xxx  | `#uuu7` | false | 5        | 2      | 20M        |
| 3    | flask    | xxx  | `#uu87` | true  | 10       | 2      | 1G         |

#### 2.6 项目参与者

| ID   | 项目 | 用户 | 星标  |
| ---- | ---- | ---- | ----- |
| 1    | 1    | 1    | true  |
| 2    | 1    | 3    | false |

### 3. 需要实现的功能

#### 3.1 创建相应表结构

#### 3.2 离线脚本创建价格策略【免费版】

![image-20200705111057623](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20200705111057623.png)

#### 3.3 用户注册【改】

- 之前：注册成功只是新建用户
- 现在：
  - 新建用户
  - 新建交易记录【免费版】

#### 3.4 添加项目

#### 3.5 展示项目

- 星标
- 我创建的
- 我参与的

#### 3.6 星标项目